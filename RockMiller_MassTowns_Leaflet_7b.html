<!DOCTYPE html>
<html>
<title>Massachusetts Settlements (Rock Miller)</title>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>.textbox {width: 60px; height: 20px; padding: 1px}</style>
<head>
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""/>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
     integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
     crossorigin=""></script>

<script src="https://unpkg.com/jquery"></script>

<script src="leaflet.ajax.js"></script>

<script src="https://unpkg.com/leaflet-providers@latest/leaflet-providers.js"></script>

<style>
.w3-container {
    line-height: 1.2;
}
.flex-container {
  display: flex;
  height: 600px;
  flex-direction: row;
  flex-wrap: nowrap;
  justify-content: center;
  align-content: space-around;
  align-items: start;
}
p {
    text-align: left;
}
h1 {
  text-align: left;
}
h2 {
  text-align: left;
}
.storytext {
  display: contents;
  border: 2px solid black;
  background-color: white;
  padding: 10px;
  width: 200px;
  text-align: left;
}
h3 {
  text-align: left;
}
</style>

<script>
stateBorderURL = "https://raw.githubusercontent.com/rockmiller/masstowns/main/mass_state_border.geojson";
townPointsURL = "https://raw.githubusercontent.com/rockmiller/masstowns/main/mass_towns_points.geojson";

var stateBorderStyle = {color:'grey', weight: 1, fillOpacity:0}
var pointStyleDefault = {radius: 3, color: 'grey', weight: 0.5, opacity: 1, fillcolor: 'grey', fillOpacity: 0.9 };
var pointStyleOther = {radius: 3, color: 'darkpink', weight: 1, opacity: 1, fillColor: 'black', fillOpacity: 1 };

var timePeriods = [
    {period: 1, legendText: 'Settlement Period (1620-1642)', years: [1620, 1642], style: {radius: 3, color: 'darkblue', weight: 0.5, opacity: 1, fillColor: 'darkblue', fillOpacity: 1}},
    {period: 2, legendText: 'First Growth (1643-1675)', years: [1643, 1675], style: {radius: 3, color: 'blue', weight: 0.5, opacity: 0.7, fillColor: 'blue', fillOpacity: 0.7}},
    {period: 3, legendText: 'King Philips War to Queen Annes War (1676-1712)', years: [1676,1712], style: {radius: 3, color: 'darkgreen', weight: 0.5, opacity: 0.9, fillColor: 'darkgreen', fillOpacity: 0.9}},   
    {period: 4, legendText: 'Second Growth (1713-1744)', years: [1713,1744], style: {radius: 3, color: 'darkgreen', weight: 0.5, opacity: 0.7, fillColor: 'darkgreen', fillOpacity: 0.7}},
    {period: 5, legendText: 'French and Indian Wars (1745-1775)', years: [1745,1775], style: {radius: 3, color: 'indianred', weight: 0.5, opacity: 1, fillColor: 'indianred', fillOpacity: 1}},
    {period: 5, legendText: 'Revolutionary Wars (1776-1815)', years: [1776,1815], style: {radius: 3, color: 'saddlebrown', weight: 0.5, opacity: 1, fillColor: 'saddlebrown', fillOpacity: 1}}
];
function styleTowns(year) {
    for (let i of timePeriods) {
        if (year >= i.years[0] && year <= i.years[1]) { 
            console.log(year, 'in range', i.period, i.style);
            return i.style}
        else {continue;}
    }};

function defaultTowns(range, map) {
    townsLayer.eachLayer(l => {
        if(l.feature.properties.m_yrsettled >= yearRange[0] && l.feature.properties.m_yrsettled <=yearRange[1]) 
        {l.setStyle(pointStyleDefault);
            l.addTo(map);} 
        else {l.removeFrom(map);}
})};

function selectTowns(range, map) {
    townsLayer.eachLayer(l => {
        if(l.feature.properties.m_yrsettled >= yearRange[0] && l.feature.properties.m_yrsettled <=yearRange[1]) 
        {a = styleTowns(l.feature.properties.m_yrsettled);
            l.setStyle(a);
            l.addTo(map);} 
        else {l.removeFrom(map);}
})};

</script>
</head>
<body class="w3-container w3-auto">
<div class="w3-container w3-dark-grey">
    <h3>Township Settlement in Massachusetts</h3>
</div><br />

<div class="flex-container">
    <div style="flex: 4 4 900px">

<label for="startyear">From Years:</label>
<input type="text" id="startyear" name="startyear" value = 1600 class="textbox" >
<label for="endyear">To:</label>
<input type="text" id="endyear" name="endyear" value = 1815 class="textbox" >&nbsp
<button id = "year_button" name = "year_button" class="w3-btn w3-black">Select Years</button><br/><br/>

<div id="map"></div>
<style>
#map { height: 546px;
        width: 720px; }
</style>

<script>
var map = L.map('map').setView([42.26259, -71.80229],8);

var btn = document.getElementById("year_button");
btn.addEventListener("click", function(event) {
    yearRange = [document.getElementById("startyear").value, document.getElementById("endyear").value];
    console.log(yearRange);
    selectTowns(yearRange,map);
});

var base = L.tileLayer('https://tiles.stadiamaps.com/tiles/stamen_terrain_background/{z}/{x}/{y}{r}.{ext}?api_key=166a8804-2976-4723-9652-33257ce7d1e6', {
	minZoom: 6, maxZoom: 12, opacity: 0.5,
	attribution: '&copy; <a href="https://www.stadiamaps.com/" target="_blank">Stadia Maps</a> &copy; <a href="https://www.stamen.com/" target="_blank">Stamen Design</a> &copy; <a href="https://openmaptiles.org/" target="_blank">OpenMapTiles</a> &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
	ext: 'png'
}).addTo(map);

var stateBorderLayer = new L.geoJSON.ajax(stateBorderURL,{
     style: stateBorderStyle} );
console.log('state: ',stateBorderLayer);
stateBorderLayer.addTo(map);

var townsLayer = new L.geoJson.ajax(townPointsURL, {
        pointToLayer: function(feature, latlng) {
            return L.circleMarker(latlng, pointStyleDefault);
        onEachFeature: (f, l) => {
          l.bindPopup(f.properties.m_name + " (" + f.properties.m_yrsettled + ")").openPopup();
    }}});
console.log('town: ',townsLayer);
townsLayer.addTo(map);

</script>
</div>

<div style="flex: 1 1 400px; padding: 1rem; padding-top: 0rem; box-sizing: border-box; display: none">
    <h5><b>Interesting things about Puritans</b></h5>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Auctor neque vitae tempus quam pellentesque nec nam. Semper viverra nam libero justo. Fringilla ut morbi tincidunt augue interdum velit euismod. Eu consequat ac felis donec et. Commodo nulla facilisi nullam vehicula ipsum a arcu cursus vitae. Eget sit amet tellus cras adipiscing enim eu turpis egestas. Ut porttitor leo a diam sollicitudin tempor id eu nisl. Arcu dictum varius duis at consectetur. Rhoncus dolor purus non enim praesent elementum facilisis leo vel. Ultrices gravida dictum fusce ut. Ornare massa eget egestas purus. Vel pharetra vel turpis nunc eget lorem. Turpis egestas pretium aenean pharetra magna ac placerat. Tincidunt nunc pulvinar sapien et ligula ullamcorper malesuada proin. Mattis nunc sed blandit libero volutpat sed cras ornare arcu. Adipiscing elit pellentesque habitant morbi.
</p></div>

<div style="flex: 1 1 400px; padding: 1rem; padding-top: 0rem; box-sizing: border-box; display: block;">
    <h5><b>More interesting things about Puritans</b></h5>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Auctor neque vitae tempus quam pellentesque nec nam. Semper viverra nam libero justo. Fringilla ut morbi tincidunt augue interdum velit euismod. Eu consequat ac felis donec et. Commodo nulla facilisi nullam vehicula ipsum a arcu cursus vitae. Eget sit amet tellus cras adipiscing enim eu turpis egestas. Ut porttitor leo a diam sollicitudin tempor id eu nisl. Arcu dictum varius duis at consectetur. Rhoncus dolor purus non enim praesent elementum facilisis leo vel. Ultrices gravida dictum fusce ut. Ornare massa eget egestas purus. Vel pharetra vel turpis nunc eget lorem. Turpis egestas pretium aenean pharetra magna ac placerat. Tincidunt nunc pulvinar sapien et ligula ullamcorper malesuada proin. Mattis nunc sed blandit libero volutpat sed cras ornare arcu. Adipiscing elit pellentesque habitant morbi.
</p></div>

</div>
<footer class="w3-container w3-dark-grey">
    <h4>Footer</h4>
</footer>

</body>
</html>